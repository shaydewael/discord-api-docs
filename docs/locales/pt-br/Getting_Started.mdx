<LocalePicker currentLocale="pt-BR" />

# Criando seu primeiro app Discord

Apps Discord permitem que voc√™ personalize e estenda seus servidores usando uma cole√ß√£o de APIs e recursos interativos. Esse guia orientar√° voc√™ a criar seu primeiro app Discord usando JavaScript e, at√© o final, voc√™ ter√° um app que usa comandos de barra, envia mensagens e responde a intera√ß√µes de componentes.

Vamos criar um app Discord que permite que os membros do servidor joguem pedra-papel-tesoura (com 7 op√ß√µes em vez das 3 de sempre). Esse guia √© voltado para iniciantes, mas presume um entendimento b√°sico de [JavaScript](https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics).

<Collapsible title="O que vamos montar" icon="view">
O app pronto ficar√° mais ou menos assim:

![Demo do app de exemplo](getting-started-demo.gif)

S√≥ para deixar o fluxo de intera√ß√µes mais claro:

1. O Usu√°rio 1 inicia um novo jogo e escolhe o objeto usando o comando de barra `/challenge` do app.
2. Uma mensagem √© publicada no canal com um bot√£o convidando outros usu√°rios a aceitarem o desafio.
3. O Usu√°rio 2 aperta o bot√£o **Aceitar**
4. O Usu√°rio 2 recebe uma mensagem ef√™mera onde escolhe qual objeto quer usar.
5. O resultado do jogo √© postado no canal original para que todos vejam.
</Collapsible>

<Collapsible title="Recursos usados neste guia" description="Vis√£o geral das ferramentas e tecnologias que vamos usar" icon="list">
- **[Reposit√≥rio do GitHub](https://github.com/discord/discord-example-app)** onde est√° hospedado o c√≥digo deste guia, junto com alguns exemplos adicionais dos c√≥digos de cada recurso.
- **[discord-interactions](https://github.com/discord/discord-interactions-js)**, uma biblioteca que fornece tipos e fun√ß√µes auxiliares para apps Discord.
- **[Express](https://expressjs.com)**, um framework web popular para JavaScript, que usaremos para criar um servidor onde o Discord possa mandar solicita√ß√µes.
- **[Glitch](https://glitch.com/)**, um ambiente online que simplifica a constru√ß√£o e hospedagem de apps nos est√°gios iniciais de prototipagem e desenvolvimento. Voc√™ tamb√©m pode desenvolver localmente nele com uma ferramenta como a **[ngrok](https://ngrok.com/)**.
</Collapsible>

---

## Passo 1: Criando um app

Primeiro, voc√™ precisa criar o app no portal do desenvolvedor, caso ainda n√£o tenha um:

<Button href="https://discord.com/developers/applications?new_application=true" color="brand">Criar app</Button>

Insira um nome para seu app, depois aperte **Criar**.

Ap√≥s criar seu app, voc√™ chegar√° na p√°gina de **Vis√£o Geral** das configura√ß√µes, onde voc√™ pode atualizar informa√ß√µes b√°sicas do seu app, como a descri√ß√£o e o √≠cone. Voc√™ tamb√©m ver√° uma **ID de Aplicativo** e **URL de Endpoint de Intera√ß√µes**, que usaremos daqui a pouco no guia.

### Configurando seu bot

Agora, vamos configurar o [usu√°rio-bot](#DOCS_TOPICS_OAUTH2/bot-vs-user-accounts) para o seu app, de modo que ele se pare√ßa e se comporte de forma similar a outros membros do servidor.

Na barra lateral esquerda, clique em **Bot**. Nesta p√°gina, voc√™ pode definir configura√ß√µes como as [inten√ß√µes privilegiadas](#DOCS_TOPICS_GATEWAY/privileged-intents) ou se ele pode ser instalado por outros usu√°rios.

<Collapsible title="O que s√£o inten√ß√µes?" description="Introdu√ß√£o a inten√ß√µes padr√£o e privilegiadas" icon="question">
Inten√ß√µes determinam quais eventos o Discord enviar√° para o seu app quando voc√™ criar uma [conex√£o ao API de Gateway](#DOCS_TOPICS_GATEWAY). Por exemplo, se voc√™ quiser que seu app fa√ßa alguma coisa quando usu√°rios adicionam uma rea√ß√£o a uma mensagem, voc√™ pode passar a inten√ß√£o `GUILD_MESSAGE_REACTIONS` (`1 << 10`).

Algumas inten√ß√µes s√£o [privilegiadas](#DOCS_TOPICS_GATEWAY/privileged-intents), ou seja, elas permitem que seu app acesse dados que podem ser considerados sigilosos (como conte√∫do de mensagens). Inten√ß√µes privilegiadas aparecem e podem ser ligadas ou desligadas na p√°gina de **Bots** das configura√ß√µes do seu app. Inten√ß√µes padr√£o (n√£o-privilegiadas) n√£o requerem permiss√µes ou configura√ß√µes adicionais.

Para mais informa√ß√µes sobre as inten√ß√µes e uma lista completa das inten√ß√µes dispon√≠veis e dos eventos associados a elas, leia a [documenta√ß√£o do Gateway](#DOCS_TOPICS_GATEWAY/gateway-intents).
</Collapsible>

![Aba de Bots nas configura√ß√µes do app](app-add-bot.png)

Tamb√©m h√° uma se√ß√£o **Token** na p√°gina **Bot**, que permite que voc√™ copie e redefina o token do seu bot.

Tokens de bots s√£o usados para autorizar solicita√ß√µes de API e cont√™m as permiss√µes do seu usu√°rio-bot, ou seja, s√£o *extremamente confidenciais*. Certifique-se de *nunca* compartilhar seu token ou inclu√≠-lo em qualquer tipo de controle de vers√£o.

Pode copiar o token, e guarde-o em um lugar seguro (como um gerenciador de senhas).

> aviso
> Voc√™ n√£o conseguir√° mais ver seu token a menos que gere um novo, ent√£o trate de guard√°-lo em um lugar seguro.

### Adicionando escopos e permiss√µes de bot

Apps precisam da permiss√£o do usu√°rio que o est√° instalando para realizar a√ß√µes no Discord (como criar um comando de barra ou acessar uma lista de membros do servidor). Vamos selecionar alguns escopos e permiss√µes para solicitar antes de instalar o app.

<Collapsible title="O que s√£o escopos e permiss√µes?" description="Introdu√ß√£o a escopos e permiss√µes de bot" icon="question">
Ao criar um app, escopos e permiss√µes determinam o que seu app pode fazer e acessar nos servidores do Discord.

- [Escopos OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes) determinam quais dados e quais a√ß√µes seu app pode acessar e realizar, concedidos em nome de um usu√°rio que esteja instalando ou autenticando o app.
- [Permiss√µes](#DOCS_TOPICS_PERMISSIONS/permission-overwrites) s√£o as permiss√µes granulares para seu usu√°rio-bot, iguais √†s que outros usu√°rios do Discord t√™m. Elas podem ser aprovadas pelo usu√°rio que est√° instalando ou, mais tarde, atualizando o bot com configura√ß√µes de servidor ou [redefini√ß√µes de permiss√£o](#DOCS_TOPICS_PERMISSIONS/permission-overwrites).
</Collapsible>

Clique em **OAuth2** na barra lateral, depois selecione o **gerador de URL**.

> info
> O gerador de URL cria um link de instala√ß√£o baseado nos escopos e permiss√µes que voc√™ selecionou para o seu app. Voc√™ pode usar o link para instalar o app no seu pr√≥prio servidor, ou compartilh√°-lo com outras pessoas para que elas as instalem.

Por ora, adicione dois escopos:
- `applications.commands`, que permite que seu app crie [comandos](#DOCS_INTERACTIONS_APPLICATION_COMMANDS).
- `bot` adiciona seu usu√°rio-bot. Ap√≥s selecionar `bot`, tamb√©m d√° para selecionar v√°rias permiss√µes para o seu bot. Por ora, pode escolher s√≥ **Enviar Mensagens**.

Leia a documenta√ß√£o para ver uma lista de todos os [escopos OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes) ou saber mais sobre [permiss√µes](#DOCS_TOPICS_PERMISSIONS).

### Instalando seu app

Ao adicionar escopos, voc√™ deve ver um URL que pode copiar para instalar seu app.

![Captura de tela do gerador de URL](url-generator.png)

> info
> Ao desenvolver apps, √© melhor cri√°-los e instal√°-los em um servidor que ningu√©m usa. Se j√° n√£o tiver seu pr√≥prio servidor, pode [criar um de gra√ßa](https://support.discord.com/hc/en-us/articles/204849977-How-do-I-create-a-server-).

Copie o URL acima e cole-o no seu navegador. A p√°gina vai te guiar pelo fluxo da instala√ß√£o, onde voc√™ deve se certificar que est√° instalando seu app num servidor onde possa desenvolv√™-lo e test√°-lo.

Ap√≥s instalar seu app, voc√™ pode entrar no servidor e ver que ele entrou ‚ú®

Com seu app configurado e instalado, vamos come√ßar o desenvolvimento.

---

## Passo 2: Executando seu app

Todo o c√≥digo usado no app de exemplo est√° dispon√≠vel no [reposit√≥rio do GitHub](https://github.com/discord/discord-example-app).

Para simplificar o desenvolvimento, o app usa o [discord-interactions](https://github.com/discord/discord-interactions-js), que fornece tipos e fun√ß√µes auxiliares. Se voc√™ preferir usar outros idiomas ou bibliotecas, acesse a documenta√ß√£o dos [Recursos de Comunidade](#DOCS_TOPICS_COMMUNITY_RESOURCES).

### Remixando o projeto

Este guia usa o Glitch, que permite que voc√™ clone e desenvolva o app no seu navegador. Se voc√™ preferir desenvolver seu app localmente, o [LEIAME](https://github.com/discord/discord-example-app#running-app-locally) cont√©m instru√ß√µes sobre como usar o ngrok.

> info
> Apesar do Glitch ser √≥timo para desenvolvimento e testagem, ele tem restri√ß√µes t√©cnicas (ver https://help.glitch.com/hc/en-us/articles/16287495313293-Technical-Restrictions), ent√£o considere outras hospedagens quando for desenvolver para produ√ß√£o.

Para come√ßar, **[remixe (ou clone) o projeto do Glitch üéè](https://glitch.com/edit/#!/import/git?url=https://github.com/discord/discord-example-app.git)**.

Ap√≥s remixar o projeto, voc√™ abrir√° um projeto novo do Glitch.

<Collapsible title="Interface de projeto do Glitch" description="Vis√£o geral da interface do projeto do Glitch" icon="view">
![Vis√£o geral do projeto do Glitch](glitch-project.png)

- Seu **nome de projeto** √© um nome √∫nico para seu projeto, que aparece no canto superior-esquerdo.
- **`.env`** √© o arquivo onde todas as suas credenciais do seu app s√£o armazenadas.
- **Registros** s√£o onde aparecem os resultados do seu projeto. Eles s√£o √∫teis para verificar se o app est√° sendo executado ou ler informa√ß√µes sobre erros que o app encontrar.
- O bot√£o **Compartilhar** no canto superior direito √© onde aparece a URL do seu projeto, que voc√™ usar√° mais tarde neste guia para montar a interatividade.
</Collapsible>

#### Estrutura do projeto

Todos os arquivos do projeto ficam do lado esquerdo do seu projeto do Glitch. Abaixo, uma vis√£o geral das pastas e arquivos principais:

```
‚îú‚îÄ‚îÄ examples    -> amostras de apps curtos de cada recurso
‚îÇ   ‚îú‚îÄ‚îÄ app.js  -> c√≥digo app.js finalizado
‚îÇ   ‚îú‚îÄ‚îÄ button.js
‚îÇ   ‚îú‚îÄ‚îÄ command.js
‚îÇ   ‚îú‚îÄ‚îÄ modal.js
‚îÇ   ‚îú‚îÄ‚îÄ selectMenu.js
‚îú‚îÄ‚îÄ .env        -> suas credenciais e IDs
‚îú‚îÄ‚îÄ app.js      -> entrypoint principal do app
‚îú‚îÄ‚îÄ commands.js -> payloads e auxiliares dos comandos de barra
‚îú‚îÄ‚îÄ game.js     -> l√≥gica espec√≠fica do pedra-papel-tesoura
‚îú‚îÄ‚îÄ utils.js    -> fun√ß√µes utilit√°rias e enums
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .gitignore
```

### Adicionando credenciais

J√° existem alguns c√≥digos no seu arquivo `app.js`, mas voc√™ precisar√° do token e ID do seu app para fazer solicita√ß√µes. Todas as suas credenciais podem ser armazenadas diretamente no arquivo `.env`.

Primeiro, copie o token do seu bot obtido anteriormente e cole-o na vari√°vel **`DISCORD_TOKEN`** do seu arquivo `.env`.

Em seguida, navegue at√© a p√°gina **Vis√£o Geral** do seu app, copie a **ID do app** e a **Chave P√∫blica**. Cole os valores no seu arquivo `.env` como **`APP_ID`** e **`PUBLIC_KEY`**.

Com suas credenciais configuradas, vamos instalar e direcionar os comandos de barra.

### Instalando comandos de barra

> info
> Para instalar comandos de barra, o app usa [`node-fetch`](https://github.com/node-fetch/node-fetch). Voc√™ pode ver a implementa√ß√£o da instala√ß√£o em `utils.js` dentro da fun√ß√£o `DiscordRequest()`.

O projeto cont√©m um script `register` que voc√™ pode usar para instalar os comandos em `ALL_COMMANDS`, que s√£o definidos no fim de `commands.js`. Ele instala os comandos como globais chamando o endpoint [`PUT /applications/<APP_ID>/commands`](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/bulk-overwrite-global-application-commands) das APIs HTTP.

Se quiser personalizar seus comandos ou adicionar novos, voc√™ pode consultar a estrutura de comando na [documenta√ß√£o de comandos](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-structure).

Execute o script `register` clicando em **Terminal** na parte de baixo do seu projeto do Glitch e colando o seguinte comando:

```
npm run register
```

Aperte enter para executar o comando.

Quando voltar l√° para seu servidor, voc√™ deve ver os comandos de barra aparecendo. Mas, se tentar execut√°-los, nada vai acontecer, pois seu app n√£o est√° recebendo ou processando solicita√ß√µes do Discord.

<Collapsible title="O que s√£o as APIs do Discord?" description="Vis√£o geral das APIs HTTP e de Gateway do Discord" icon="question">
O Discord tem duas APIs que voc√™ pode combinar como quiser para criar apps:

- A **[API HTTP](#DOCS_REFERENCE/http-api)** √© uma API tipo REST para opera√ß√µes gerais como o envio e atualiza√ß√£o de dados no Discord, ou solicita√ß√µes de dados sobre recursos.
- A **[API de Gateway](#DOCS_REFERENCE/gateway-websocket-api)** √© uma API baseada em WebSocket que ajuda a manter o estado ou ouvir eventos que est√£o ocorrendo em um servidor Discord. N√£o vamos us√°-la neste guia, mas voc√™ pode ler mais sobre como criar uma conex√£o de Gateway e os diferentes eventos que ela pode ouvir na [documenta√ß√£o de Gateway](#DOCS_TOPICS_GATEWAY).
</Collapsible>

---

## Passo 3: Lidando com a interatividade

Para permitir que seu app receba solicita√ß√µes de comando de barra (e outras intera√ß√µes), o Discord precisa de um URL p√∫blico para onde mand√°-las. Este URL pode ser configurado nas configura√ß√µes do seu app, como o **URL de Endpoint de Intera√ß√µes**.

### Adicionando um URL de Endpoint de Intera√ß√µes

Projetos do Glitch t√™m um URL p√∫blico exposto por padr√£o. Copie o URL do seu projeto clicando no bot√£o **Compartilhar** no canto superior direito, depois copie o link do projeto "Live site" perto do final do modal.

> info
> Se voc√™ estiver desenvolvendo localmente, h√° instru√ß√µes sobre como direcionar solicita√ß√µes ao seu ambiente local no [LEIAME do GitHub](https://github.com/discord/discord-example-app#running-app-locally).

Com o link copiado, v√° at√© as configura√ß√µes do seu app no [portal do desenvolvedor](https://discord.com/developers/applications).

Na p√°gina de **Informa√ß√µes Gerais** do seu app, h√° uma op√ß√£o de **URL de Endpoint de Intera√ß√£o**, onde voc√™ deve colar o URL do seu app e colocar `/interactions` no fim dele, pois √© da√≠ que o app Express est√° configurado para esperar solicita√ß√µes.

![URL de Endpoint de Intera√ß√µes nas configura√ß√µes do app](interactions-url.png)

Clique em **Salvar Mudan√ßas** e certifique-se que seu endpoint seja verificado corretamente.

O app de exemplo faz a verifica√ß√£o de duas formas:
- Usando a `PUBLIC_KEY` e o [pacote discord-interactions](https://github.com/discord/discord-interactions-js#usage) com uma fun√ß√£o wrapper (importada do `utils.js`) que faz ele se conformar √† [interface `verify` do Express](http://expressjs.com/en/5x/api.html#express.json). Esse processo √© realizado em cada solicita√ß√£o que seu app recebe.
- Ele responde a solicita√ß√µes `PING` recebidas.

Voc√™ pode ler mais sobre como preparar seu app para receber intera√ß√µes na [documenta√ß√£o de intera√ß√µes](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/receiving-an-interaction).

### Processando solicita√ß√µes de comando de barra

Com o endpoint verificado, v√° at√© o arquivo `app.js` do seu projeto e procure o bloco de c√≥digo que cuida do comando `/test`:

```javascript
// comando "test"
if (name === 'test') {
    // Envia uma mensagem para o canal de onde o comando foi ativado
    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        // Escolhe um emoji aleat√≥rio para enviar de uma fun√ß√£o auxiliar
        content: 'hello world ' + getRandomEmoji(),
    },
    });
}
```

O c√≥digo acima respondeu √† intera√ß√£o com uma mensagem no canal na qual ela se originou. Voc√™ pode ver todos os tipos de respostas dispon√≠veis (por exemplo, responder com um modal) [na documenta√ß√£o](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-response-object-interaction-callback-type).

> info
> `InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE` √© uma constante [exportada do `discord-interactions`](https://github.com/discord/discord-interactions-js/blob/main/src/index.ts#L33)

V√° at√© seu servidor e certifique-se que o comando de barra `/test` do seu app esteja funcionando. Ao ativ√°-lo, o app deve mandar uma mensagem que cont√©m "hello world" seguido de um emoji aleat√≥rio.

Na se√ß√£o a seguir, adicionaremos um comando adicional que usa op√ß√µes de comando de barra, bot√µes e menus de sele√ß√£o para construir o jogo de pedra-papel-tesoura.

---

## Passo 4: Adicionando componentes de mensagens

Usaremos o comando `/challenge` para iniciar nosso jogo estilo pedra-papel-tesoura. Quando o comando √© ativado, o app enviar√° componentes de mensagem ao canal, que guiar√£o os usu√°rios para completar o jogo.

### Adicionando um comando com op√ß√µes

O comando `/challenge`, chamado `CHALLENGE_COMMAND` no `commands.js`, tem um array de `options`. No nosso app, as op√ß√µes s√£o objetos representando coisas diferentes que usu√°rios podem escolher enquanto jogam pedra-papel-tesoura, gerados usando chaves de `RPSChoices` em `game.js`.

Voc√™ pode ler mais sobre op√ß√µes de comando e a estrutura delas [na documenta√ß√£o](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-option-structure).

> info
> Este guia n√£o vai falar muito do arquivo `game.js`, mas fique √† vontade para mexer nele, mudando os comandos ou as op√ß√µes deles.

<Collapsible title="Lidando com intera√ß√µes de comando" description="C√≥digo para lidar com o comando de desafio e responder com uma mensagem com um bot√£o" icon="code" open>

Para lidar com o comando `/challenge`, adicione o seguinte c√≥digo ap√≥s o bloco "se" `if name === ‚Äútest‚Äù`:

```javascript
// comando "challenge"
if (name === 'challenge' && id) {
    const userId = req.body.member.user.id;
    // Objeto de escolha do usu√°rio
    const objectName = req.body.data.options[0].value;

    // Criar jogo ativo usando ID da mensagem como ID de jogo
    activeGames[id] = {
        id: userId,
        objectName,
    };

    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        content: `Rock papers scissors challenge from <@${userId}>`,
        components: [
        {
            type: MessageComponentTypes.ACTION_ROW,
            components: [
            {
                type: MessageComponentTypes.BUTTON,
                // Anexar a ID do jogo para usar mais tarde
                custom_id: `accept_button_${req.body.id}`,
                label: 'Accept',
                style: ButtonStyleTypes.PRIMARY,
            },
            ],
        },
        ],
    },
    });
}
```


> info
> Se n√£o tiver certeza onde colar o c√≥digo, voc√™ pode ver o c√≥digo completo em `examples/app.js` no projeto do Glitch ou no root `app.js` [no GitHub](https://github.com/discord/discord-example-app/blob/main/app.js).

O c√≥digo acima faz algumas coisas:
1. Analisa o corpo da solicita√ß√£o para obter a ID do usu√°rio que ativou o comando de barra (`userId`) e a op√ß√£o (escolha de objeto) que ele(a) selecionou (`objectName`).
2. Adiciona um novo jogo ao objeto `activeGames` usando a ID de intera√ß√£o. O jogo ativo registra o `userId` e o `objectName`.
3. Envia uma mensagem de volta ao canal com um bot√£o contendo uma `custom_id` de `accept_button_<SOME_ID>`.

> aviso
> O c√≥digo de exemplo usa um objeto como armazenamento na mem√≥ria, mas os apps para produ√ß√£o devem ter bases de dados.

Ao enviar uma mensagem com [componentes de mensagem](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/what-is-a-component), os payloads individuais s√£o anexados a um array `components`. Componentes acion√°veis (como bot√µes) precisam estar dentro de uma [fileira de a√ß√µes](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/action-rows), como aparece na amostra do c√≥digo.

Repare na `custom_id` enviada com componentes de mensagem (neste caso `accept_button_`) com a ID do jogo ativo anexada a ela. Uma `custom_id` pode ser usada para lidar com solicita√ß√µes enviadas pelo Discord quando algu√©m interage com o componente. Voc√™ ver√° isso daqui a pouco.

Agora, quando voc√™ usar o comando `/challenge` e escolher uma op√ß√£o, seu app mandar√° uma mensagem com o bot√£o **Aceitar**. Vamos adicionar um c√≥digo para lidar com o apertar do bot√£o.

</Collapsible>

<Collapsible title="Lidar com intera√ß√µes de bot√£o" description="C√≥digo para lidar com cliques em bot√µes e respostas com mensagens ef√™meras" icon="code" open>

Quando usu√°rios interagem com um componente de mensagem, o Discord envia uma solicita√ß√£o com um [tipo de intera√ß√£o](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-object-interaction-type) de `3` (ou o valor `MESSAGE_COMPONENT` ao usar `discord-interactions`).

Para montar um handler para o bot√£o, vamos verificar o `type` da intera√ß√£o e alinhando com a `custom_id`.

Cole o seguinte c√≥digo sob o handler de tipo para `APPLICATION_COMMAND`s:

```javascript
if (type === InteractionType.MESSAGE_COMPONENT) {
// custom_id definida no payload ao enviar o componente da mensagem
const componentId = data.custom_id;

  if (componentId.startsWith('accept_button_')) {
    // recebe a ID de jogo associada
    const gameId = componentId.replace('accept_button_', '');
    // Exclui a mudan√ßa com o token no corpo da solicita√ß√£o
    const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
    try {
      await res.send({
        type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
        data: {
          // Escolhe um emoji aleat√≥rio para enviar de uma fun√ß√£o auxiliar
          content: 'What is your object of choice?',
          // Indica que ser√° uma mensagem ef√™mera
          flags: InteractionResponseFlags.EPHEMERAL,
          components: [
            {
              type: MessageComponentTypes.ACTION_ROW,
              components: [
                {
                  type: MessageComponentTypes.STRING_SELECT,
                  // Anexa a ID de jogo
                  custom_id: `select_choice_${gameId}`,
                  options: getShuffledOptions(),
                },
              ],
            },
          ],
        },
      });
      // Exclui a mensagem anterior
      await DiscordRequest(endpoint, { method: 'DELETE' });
    } catch (err) {
      console.error('Error sending message:', err);
    }
  }
}
```

O c√≥digo acima:
1. Procura uma `custom_id` que combine com a enviada originalmente (neste caso, ela come√ßa com `accept_button_`). A ID personalizada tamb√©m tem a ID do jogo ativo anexada, ent√£o armazenamos ela na `gameID`.
2. [Exclui a mensagem original](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/delete-original-interaction-response) chamando um webhook atrav√©s do `node-fetch` e passando o `token` de intera√ß√£o √∫nica no corpo da solicita√ß√£o. Isso serve para manter o canal limpo e para impedir que outros usu√°rios cliquem no bot√£o.
3. Responde √† solicita√ß√£o enviando uma mensagem que cont√©m um menu de sele√ß√£o com as escolhas de objeto do jogo. O payload deve ser bem parecido com o anterior, com exce√ß√£o do array de `options` e `flags: 64`, [que indica que a mensagem √© ef√™mera](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/create-followup-message).

O array de `options` √© povoado usando o m√©todo `getShuffledOptions()` do `game.js`, que manipula os valores de `RPSChoices` para se conformar ao formato das [op√ß√µes de componente de mensagem](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/select-menu-object-select-option-structure).

</Collapsible>

<Collapsible title="Lidando com intera√ß√µes do menu de sele√ß√£o" description="C√≥digo que responde a intera√ß√µes no menu de sele√ß√£o e atualiza√ß√µes do estado de jogo" icon="code" open>

A √∫ltima coisa a adicionar √© um c√≥digo que lide com intera√ß√µes do menu de sele√ß√£o e envie os resultados do jogo para o canal.

J√° que menus de sele√ß√£o s√£o s√≥ outro componente de mensagem, o c√≥digo que cuida das intera√ß√µes deles ser√£o quase id√™nticos aos dos bot√µes.

Modifique o c√≥digo acima para lidar com o menu de sele√ß√£o:

```javascript
if (type === InteractionType.MESSAGE_COMPONENT) {
// custom_id definida no payload ao enviar o componente da mensagem
const componentId = data.custom_id;

  if (componentId.startsWith('accept_button_')) {
    // recebe a ID de jogo associada
    const gameId = componentId.replace('accept_button_', '');
    // Exclui a mudan√ßa com o token no corpo da solicita√ß√£o
    const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
    try {
      await res.send({
        type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
        data: {
          // Escolhe um emoji aleat√≥rio para enviar de uma fun√ß√£o auxiliar
          content: 'What is your object of choice?',
          // Indica que ser√° uma mensagem ef√™mera
          flags: InteractionResponseFlags.EPHEMERAL,
          components: [
            {
              type: MessageComponentTypes.ACTION_ROW,
              components: [
                {
                  type: MessageComponentTypes.STRING_SELECT,
                  // Anexa a ID de jogo
                  custom_id: `select_choice_${gameId}`,
                  options: getShuffledOptions(),
                },
              ],
            },
          ],
        },
      });
      // Exclui a mensagem anterior
      await DiscordRequest(endpoint, { method: 'DELETE' });
    } catch (err) {
      console.error('Error sending message:', err);
    }
  } else if (componentId.startsWith('select_choice_')) {
    // recebe a ID de jogo associada
    const gameId = componentId.replace('select_choice_', '');

    if (activeGames[gameId]) {
      // Recebe a ID de usu√°rio e escolha de objeto do usu√°rio que responde
      const userId = req.body.member.user.id;
      const objectName = data.values[0];
      // Calcula o resultado na fun√ß√£o auxiliar
      const resultStr = getResult(activeGames[gameId], {
        id: userId,
        objectName,
      });

      // Remove o jogo da armazenagem
      delete activeGames[gameId];
      // Atualiza a mensagem com o token no corpo da solicita√ß√£o
      const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;

      try {
        // Envia os resultados
        await res.send({
          type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
          data: { content: resultStr },
        });
        // Atualiza a mensagem ef√™mera
        await DiscordRequest(endpoint, {
          method: 'PATCH',
          body: {
            content: 'Nice choice ' + getRandomEmoji(),
            components: []
          }
        });
      } catch (err) {
        console.error('Error sending message:', err);
      }
    }
  }
}
```

Parecido com c√≥digos anteriores, o c√≥digo acima busca a ID de usu√°rio e a sele√ß√£o de objeto da solicita√ß√£o de intera√ß√£o.

Essas informa√ß√µes, junto com a ID do usu√°rio original e a sele√ß√£o feita no objeto `activeGames`, s√£o passadas para a fun√ß√£o `getResult()`. A `getResult()` determina o vencedor, depois monta uma string leg√≠vel para enviar de volta ao canal.

Tamb√©m estamos chamando outro webhook, desta vez para [atualizar a mensagem ef√™mera complementar](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/edit-followup-message), j√° que ela n√£o pode ser exclu√≠da.

Por fim, os resultados s√£o enviados no canal usando o tipo de intera√ß√£o de resposta `CHANNEL_MESSAGE_WITH_SOURCE`.

</Collapsible>

...e pronto üéä Pode testar seu app pra garantir que est√° tudo funcionando.

---

## Pr√≥ximos passos

Parab√©ns por criar seu primeiro app Discord! ü§ñ

Esperamos que voc√™ tenha aprendido um pouco sobre apps Discord e como torn√°-los interativos. Daqui, voc√™ pode continuar a montar seu app ou explorar outras possibilidades:
- Ler **[a documenta√ß√£o](#DOCS_INTRO)** para informa√ß√µes mais detalhadas sobre recursos da API.
- Navegar pela pasta `examples/` neste projeto para ver exemplos de c√≥digo menores e mais espec√≠ficos.
- Conferir **[recursos da comunidade](#DOCS_TOPICS_COMMUNITY_RESOURCES)** para ferramentas espec√≠ficas de certas linguagens de programa√ß√£oque s√£o mantidas por membros da comunidade.
- Ler nosso tutorial sobre [como hospedar apps Discord no Cloudflare Workers](#DOCS_TUTORIALS_HOSTING_ON_CLOUDFLARE_WORKERS)
- Entrar no **[servidor de Desenvolvedores Discord](https://discord.gg/discord-developers)** para fazer perguntas sobre a API, participar de eventos organizados pela equipe da API do Discord e interagir com outros desenvolvedores.
