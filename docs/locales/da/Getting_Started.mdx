<LocalePicker currentLocale="da" />

# S√•dan udvikler du din f√∏rste Discord-app

Discord-apps lader dig tilpasse og udvide dine servere med en samling af APIs og interaktive funktioner. Denne vejledning tager dig gennem processen at udvikle din f√∏rste Discord-app i JavaScript. N√•r du er f√¶rdig, vil du have en app, der bruger slash-kommandoer, sender beskeder og reagerer p√• interaktion med komponenterne.

Vi vil udvikle en Discord-app, der lader servermedlemmerne spille sten-saks-papir (med syv valgmuligheder i stedet for de s√¶dvanlige tre). Denne vejledning er m√•lrettet nybegyndere, men den antager et basalt kendskab til [JavaScript](https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics).

<Collapsible title="Det her skal vi lave" icon="view">
Her kan du se, hvordan den f√¶rdige app vil se ud:

![Demo af app-eksempel](getting-started-demo.gif)

Lad os g√∏re brugerrejsen lidt mere tydelig:

1. Bruger 1 starter et nyt spil og v√¶lger deres genstand med appens `/challenge` slash-kommando
2. En besked bliver sendt til kanalen med en knap, s√• andre kan acceptere udfordringen
3. Bruger 2 trykker p√• knappen **Accept√©r**
4. Bruger 2 modtager en kortvarig besked, hvorfra vedkommende skal v√¶lge sin genstand
5. Resultatet af spillet bliver delt i den oprindelige kanal, hvor alle kan se det
</Collapsible>

<Collapsible title="Ressourcer brugt i denne vejledning" description="Oversigt over v√¶rkt√∏jerne og teknologien vi benytter" icon="list">
- **[GitHub repository](https://github.com/discord/discord-example-app)**, hvor koden fra denne vejledning bor sammen med nogle ekstra funktionsspecifikke kodeeksempler.
- **[discord-interactions](https://github.com/discord/discord-interactions-js)**, et bibliotek med typer og hj√¶lpefunktioner til Discord-apps.
- **[Express](https://expressjs.com)**, et popul√¶rt JavaScript-web framework vi bruger til at oprette en server, hvor Discord kan sende os anmodninger.
- **[Glitch](https://glitch.com/)**, et online milj√∏, der simplificerer udviklingen og hostingen af apps i de tidlige prototype- og udviklingsfaser. Du kan og√•s udvikle lokalt med et v√¶rkt√∏j som **[ngrok](https://ngrok.com/)**.
</Collapsible>

---

## Step 1: Skab en app

F√∏rst skal du skabe en app i udviklerportalen, hvis du ikke allerede har en:

<Button href="https://discord.com/developers/applications?new_application=true" color="brand">Skab app</Button>

Navngiv din app, og tryk p√• **Skab**.

N√•r du har skabt din app, lander du p√• siden **Generel oversigt** i appens indstillinger, hvor du kan opdatere grundl√¶ggende information om din app s√•som beskrivelse og ikon. Du kan ogs√• se et **applikations-ID** og en **URL for slutpunkt for interaktioner**, som vi skal bruge lidt senere i denne vejledning.

### Konfigurering af din bot

Derefter konfigurerer vi [bot-brugeren](#DOCS_TOPICS_OAUTH2/bot-vs-user-accounts) for din app, s√• den kan se ud som og opf√∏re sig ligesom andre medlemmer af serveren.

I sidepanelet til venstre skal du klikke p√• **Bot**. P√• denne side kan du konfigurere indstillinger som dens [priviligerede intentioner](#DOCS_TOPICS_GATEWAY/privileged-intents), eller om den kan installeres af andre brugere.

<Collapsible title="Hvad er intentioner?" description="Introduktion til standard- og privilegerede intentioner" icon="question">
Intentioner bestemmer, hvilke h√¶ndelser Discord sender din app til, n√•r du laver en [Gateway API-forbindelse](#DOCS_TOPICS_GATEWAY). Hvis du eksempelvis vil have din app til at g√∏re noget, n√•r brugere f√∏jer en reaktion til en besked, kan du sende `GUILD_MESSAGE_REACTIONS` (`1 << 10`)-intentionen.

Nogle intentioner er [privilegerede](#DOCS_TOPICS_GATEWAY/privileged-intents), hvilket betyder, at de lader din app tilg√• data, der kan v√¶re f√∏lsomme (s√•som indholdet af beskeder). Privilegerede intentioner findes og kan styres p√• siden **Bot** i din apps indstillinger. Standard, ikke-privilegerede intentioner kr√¶ver ingen yderligere tilladelser eller konfigurationer.

Du finder mere information om intentioner sammen med en liste over alle intentioner, inkl. deres tilknyttede h√¶ndelser i [Gateway-dokumentationen](#DOCS_TOPICS_GATEWAY/gateway-intents).
</Collapsible>

![Bot-fanen i appens indstillinger](app-add-bot.png)

Der er ogs√• en **Token**-sektion p√• siden **Bot**, der lader dig kopiere og nulstille din bots token.

Bot-tokens bruges til at godkende API-anmodninger og b√¶re din bot-brugers tilladelser, hvilket g√∏r dem *meget f√∏lsomme*. S√∏rg for *ikke* at dele din token eller bruge den til nogen form for versionskontrol.

Kopier nu din token, og gem den et sikkert sted (s√•som i en administrator af adgangskoder).

> warn
> Du vil ikke kunne se din token igen, medmindre du regenererer den, s√• s√∏rg for at opbevare den et sikkert sted.

### Tilf√∏jelse af anvendelsesomr√•der og bot-tilladelser

Apps skal bruge godkendelse fra den installerende bruger for at udf√∏re handlinger i Discord (s√•som at lave en slash-kommando eller hente en liste over servermedlemmer). Lad os v√¶lge et par anvendelsesomr√•der og tilladelser, der skal anmodes om, inden appen bliver installeret.

<Collapsible title="Hvad are anvendelsesomr√•der og tilladelser?" description="Introduktion til anvendelsesomr√•der og bot-tilladelser" icon="question">
N√•r du laver en app, bestemmer anvendelsesomr√•der og tilladelser, hvad din app kan g√∏re og f√• tilgang til p√• Discord-servere.

- [OAuth2-anvendelsesomr√•der](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes) bestemmer, hvilken dataadgang og hvilke handlinger din app har adgang til, tildelt p√• vegne af en installerende eller bekr√¶ftende bruger.
- [Tilladelser](#DOCS_TOPICS_PERMISSIONS/permission-overwrites) er din bot-brugers detaljerede tilladelser, ligesom andre brugere p√• Discord ogs√• har. De kan godkendes af den installerende bruger eller senere opdateres under serverens indstillinger eller med [overskrivninger af tilladelser](#DOCS_TOPICS_PERMISSIONS/permission-overwrites).
</Collapsible>

Klik p√• **OAuth2** i venstre sidepanel, og v√¶lg **URL-generator**.

> info
> URL-generatoren skaber et installationslink baseret p√• de anvendelsesomr√•der og tilladelser, du har valgt for din app. Du kan bruge linket til at installere appen p√• din egen server eller dele det med andre, s√• de kan installere den.

Lige nu skal du tilf√∏je to anvendelsesomr√•der:
- `applications.commands`, der lader din app skabe [kommandoer](#DOCS_INTERACTIONS_APPLICATION_COMMANDS).
- `bot`, der tilf√∏jer din bot-bruger. N√•r du har valgt `bot`, kan du ogs√• v√¶lge forskellige tilladelse til din bot. Lige nu skal du bare afkrydse **Send meddelelser**.

Se en liste med alle [OAuth2-anvendelsesomr√•der](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes), eller l√¶s mere om [tilladelser](#DOCS_TOPICS_PERMISSIONS) i dokumentationen.

### Installation af din app

N√•r du har tilf√∏jet anvendelsesomr√•der, burde du se en URL, som du kan kopiere og bruge til at installere din app.

![Screenshot af URL-generator](url-generator.png)

> info
> N√•r du udvikler apps, b√∏r du bygge og teste dem p√• en server, der ikke bruges aktivt af andre. Hvis du ikke har din egen server allerede, kan du [oprette en gratis](https://support.discord.com/hc/en-us/articles/204849977-How-do-I-create-a-server-).

Kopi√©r den f√∏rn√¶vnte URL, og inds√¶t den i din browser. Du bliver f√∏rt gennem installationsprocessen, hvor du skal sikre, at du installerer din app p√• en server, hvor du kan udvikle p√• den og teste den.

N√•r du har installeret din app, kan du g√• til din server og se, at den har tilsluttet sig ‚ú®

Nu da din app er konfigureret og installeret, kan vi begynde at udvikle p√• den.

---

## Trin 2: K√∏r din app

Al koden brugt i app-eksemplet kan findes i [GitHub repository](https://github.com/discord/discord-example-app).

For at g√∏re det lidt nemmere at udvikle appen, bruger den [Discord-interaktioner](https://github.com/discord/discord-interactions-js), der leverer typer og hj√¶lpefunktioner. Hvis du foretr√¶kker at anvende andre sprog eller biblioteker, skal du se dokumentationen om [Community-ressourcer](#DOCS_TOPICS_COMMUNITY_RESOURCES).

### Remix af projektet

Denne vejledning bruger Glitch, der lader dig klone og udvikle inde i din browser. Hvis du foretr√¶kker at udvikle din app lokalt, er der en vejledning i at bruge ngrok [i README](https://github.com/discord/discord-example-app#running-app-locally).

> info
> Glitch er fantastisk til udvikling og test, men [den har nogle tekniske begr√¶nsninger](https://help.glitch.com/kb/article/17-technical-restrictions/), s√• du b√∏r overveje andre hosting-udbydere til produktions-apps.

Begynd med at **[remixe (eller klone) Glitch-projektet üéè](https://glitch.com/edit/#!/import/git?url=https://github.com/discord/discord-example-app.git)**.

N√•r du har remixet projektet, lander du p√• et nyt Glitch-projekt.

<Collapsible title="Glitch-projektbrugerfladen" description="Oversigt over Glitch-projektbrugerfladen" icon="view">
![Glitch-projektoversigt](glitch-project.png)

- Dit **project name** er et unikt navn p√• dit projekt, der kan ses i √∏verste venstre hj√∏rne
- **`.env`** er filen, hvor alle legitimationsoplysninger for din app bliver gemt
- **Logs** er stedet, hvor dit projekts output kan findes ‚Äì det er nyttigt for at se, om appen k√∏rer, samt information om fejl, din app st√∏der p√•
- **Share**-knappen i √∏verste, h√∏jre hj√∏rne er stedet, hvor du finder det live projekts URL, som du skal bruge til at ops√¶tte interaktivitet senere i denne vejledning
</Collapsible>

#### Projektstruktur

Alle projektets filer er p√• venstre side af dit Glitch-projekt. Herunder er der en oversigt over hovedmapperne og filerne:

```
‚îú‚îÄ‚îÄ examples    -> korte, funktionsspecifikke app-pr√∏veeksemplarer
‚îÇ   ‚îú‚îÄ‚îÄ app.js  -> f√¶rdig app.js kode
‚îÇ   ‚îú‚îÄ‚îÄ button.js
‚îÇ   ‚îú‚îÄ‚îÄ command.js
‚îÇ   ‚îú‚îÄ‚îÄ modal.js
‚îÇ   ‚îú‚îÄ‚îÄ selectMenu.js
‚îú‚îÄ‚îÄ .env        -> dine legitimationsoplysninger og ID'er
‚îú‚îÄ‚îÄ app.js      -> prim√¶rt entrypoint for app
‚îú‚îÄ‚îÄ commands.js -> slash-kommandonyttelaster + hj√¶lpere
‚îú‚îÄ‚îÄ game.js     -> logik specifik til RPS
‚îú‚îÄ‚îÄ utils.js    -> utility-funktioner og enums
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .gitignore
```

### Tilf√∏j legitimationsoplysninger

Der er allerede noget kode i din `app.js`-fil, men du skal bruge din apps token og ID for at lave anmodninger. Alle dine legitimationsoplysninger kan blive gemt direkte i `.env`-filen.

F√∏rst skal du kopiere din bot-brugers token fra tidligere og inds√¶tte den i **`DISCORD_TOKEN`**-variablen i din `.env`-fil.

Derefter skal du g√• til siden **Generel oversigt** i din app og derefter kopiere dens **App ID** og **Public Key**. Inds√¶t v√¶rdierne i din `.env`-fil som **`APP_ID`** og **`PUBLIC_KEY`**.

Nu da dine legitimationsoplysninger er konfigureret, s√• lad os installere og h√•ndtere slash-kommandoer.

### Install√©r slash-kommandoer

> info
> For at installere slash-kommandoer benytter appen [`node-fetch`](https://github.com/node-fetch/node-fetch). Du kan se implementeringen af installationen i `utils.js` i `DiscordRequest()`-funktionen.

Projektet indeholder et `register`-script, du kan bruge til at installere kommandoerne i `ALL_COMMANDS`, der er defineret i bunden af `commands.js`. Det installerer kommandoerne som globale kommandoer ved at kalde HTTP API'ens [`PUT /applications/<APP_ID>/commands`](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/bulk-overwrite-global-application-commands) endpoint.

Hvis du √∏nsker at tilpasse dine kommandoer eller tilf√∏je ekstra kommandoer, kan du refererer kommandostrukturen i [kommandodokumentationen](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-structure).

K√∏r `register`-scriptet ved at klikke p√• **Terminal** i bunden af dit Glitch-projekt og inds√¶tte f√∏lgende kommando:

```
npm run registrer
```

Tryk p√• enter for at k√∏re kommandoen.

Hvis du g√•r tilbage til din server, b√∏r du nu se slash-kommandoerne. Men hvis du pr√∏ver at k√∏re dem, sker der ikek noget, da din app ikke modtager eller h√•ndterer nogen anmodninger fra Discord.

<Collapsible title="Hvad er Discords API's?" description="Oversigt over Discords HTTP og Gateway API's" icon="question">
Discord har to API's som du frit kan v√¶lge mellem og blande, n√•r du laver apps:

- **[HTTP API](#DOCS_REFERENCE/http-api)** er en REST-lignende API til generelle operationer som at sende og opdatere data i Discord eller hente data om en ressource.
- **[Gateway API](#DOCS_REFERENCE/gateway-websocket-api)** er en WebSocket-baseret API, der er nyttig til at beholde en tilstand eller lytte til begivenheder p√• en Discord-server. Vi benytter den ikke i denne vejledning, men du kan finde mere information om, hvordan du skaber en Gateway-forbindelse, samt de forskellige begivenheder, du kan lytte efter, i [Gateway-dokumentationen](#DOCS_TOPICS_GATEWAY).
</Collapsible>

---

## Trin 3: H√•ndtering af interaktivitet

For at g√∏re din app i stand til at modtage slash-kommandoanmodninger (og andre interaktioner) skal Discord bruge en offentlig URL for at sende dem. Denne URL kan konfigureres i din apps indstillinger som **slutpunkt for interaktioner**.

### Tilf√∏j en URL for et slutpunkt for interaktioner

Glitch-projekter har en offentlig URL, der som standard er synlig. Kopi√©r dit projekts URL ved at klikke p√• knappen **Del** i √∏verste, h√∏jre hj√∏rne, og kopi√©r s√• "Live site"-projektlinket n√¶r bunden af modalen.

> info
> Hvis du udvikler lokalt, er der instrukser til at f√∏re dine anmodninger til dit lokalmilj√∏ [i GitHub README](https://github.com/discord/discord-example-app#running-app-locally).

N√•r du har kopieret linket, skal du g√• til din apps indstillinger fra [udviklingsportalen](https://discord.com/developers/applications).

P√• din apps side med **Generel information** er der en instilling for **URL for slutpunkt for interaktioner**, hvor du kan inds√¶tte din apps URL og h√¶gte `/interactions` p√• den, og det er her, Express-appen konfigureres til at lytte efter anmodninger.

![URL for slutpunkt for interaktioner i app-indstillinger](interactions-url.png)

Klik p√• **Gem √¶ndringer**, og s√∏rg for, at dit slutpunkt er korrekt bekr√¶ftet.

App-eksemplet h√•ndterer bekr√¶ftelse p√• to m√•der:
- Den bruger `PUBLIC_KEY` og [discord-interaktionspakken](https://github.com/discord/discord-interactions-js#usage) med en wrapper-funktion (importeret fra `utils.js`), der g√∏r, at den passer til [Express' `verify`-brugerflade](http://expressjs.com/en/5x/api.html#express.json). Den k√∏res p√• alle indkommende anmodninger p√• din app.
- Den besvarer indkommende `PING`-anmodninger.

Du kan l√¶re mere om at forberede din app til at modtage interaktioner i [interaktionsdokumentationen](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/receiving-an-interaction).

### H√•ndtering af slash-kommandoanmodninger

N√•r slutpunktet er bekr√¶ftet, skal du g√• til dit projekts `app.js`-fil og finde kodeblokken, der h√•ndterer `/test`-kommandoen:

```javascript
// "test"-kommando
if (name === 'test') {
    // Send en besked i kanalen, hvor kommandoen blev udl√∏st
    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        // Henter en tilf√¶ldig emoji, der sendes fra en hj√¶lpefunktion
        content: 'hello world ' + getRandomEmoji(),
    },
    });
}
```

Koden herover reagerer p√• interaktionen med en besked i kanalen, hvor kommandoen kom fra. Du kan se alle tilg√¶ngelige svartyper s√•som besvarelse med en modal [i dokumentationen](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-response-object-interaction-callback-type).

> info
> `InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE` er en konstant, der er [eksporteret fra `discord-interactions`](https://github.com/discord/discord-interactions-js/blob/main/src/index.ts#L33)

G√• til din server, og s√∏rg for, at din apps `/test` slash-kommando fungerer. N√•r du udl√∏ser den, burde din app sende en besked, der indeholder teksten ‚Äúhello world‚Äù efterfulgt af en tilf√¶ldig emoji.

I den f√∏lgende sektion tilf√∏jer vi en ekstra kommando, der benytter slash-kommandoerindstillinger, knapper og valgmuligheder til at bygge sten-saks-papir-spillet.

---

## Trin 4: Tilf√∏j beskedkomponenter

`/challenge`-kommandoen er m√•den, vores sten-saks-papir-spil bliver startet. N√•r kommandoen udl√∏ses, sender appen beskedkomponenter til kanalen, der hj√¶lper brugerne med at fuldf√∏re spillet.

### Tilf√∏j en kommando med valgmuligheder

`/challenge`-kommandoen, kaldet `CHALLENGE_COMMAND` i `commands.js`, har en r√¶kke `options`. I vores app er de forskellige options objekter, der repr√¶senterer forskellige ting, en bruger kan v√¶lge mellem i et spil sten-saks-papir, genereret ved brug af n√∏gler for `RPSChoices` i `game.js`.

Du kan l√¶se mere om kommando-valgmuligheder og deres struktur [i dokumentationen](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-option-structure).

> info
> Selvom denne vejledning ikke g√•r i dybden med `game.js`-filen, er du velkommen til at grave lidt rundt og √¶ndre kommandoerne eller valgmulighederne i kommandoerne.

<Collapsible title="H√•ndtering af kommandointeraktionen" description="Koden for h√•ndteringen af udfordringskommandoen og besvarelse med en besked, der indeholder en knap" icon="code" open>

For at h√•ndtere `/challenge`-kommandoen skal du f√∏je f√∏lgende kode efter hvis-blokken `if name === ‚Äútest‚Äù`:

```javascript
// "challenge"-kommando
if (name === 'challenge' && id) {
    const userId = req.body.member.user.id;
    // Brugers genstandsvalg
    const objectName = req.body.data.options[0].value;

    // Skab aktivt spil med besked-ID som spil-ID
    activeGames[id] = {
        id: userId,
        objectName,
    };

    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        content: `Rock papers scissors challenge from <@${userId}>`,
        components: [
        {
            type: MessageComponentTypes.ACTION_ROW,
            components: [
            {
                type: MessageComponentTypes.BUTTON,
                // Tilf√∏j spil-ID til senere brug
                custom_id: `accept_button_${req.body.id}`,
                label: 'Accept',
                style: ButtonStyleTypes.PRIMARY,
            },
            ],
        },
        ],
    },
    });
}
```


> info
> Hvis du ikke er sikker p√•, hvor du skal inds√¶tte koden, kan du se den fulde kode i `examples/app.js` i Glitch-projektet eller i roden `app.js` [p√• GitHub](https://github.com/discord/discord-example-app/blob/main/app.js).

Koden herover g√∏r et par forskellige ting:
1. Parser anmodningsdataen for at f√• ID p√• brugeren, der udl√∏ste slash-kommandoen (`userId`), og valget (genstandsvalg) de traf (`objectName`).
2. Tilf√∏jer et nyt spil til `activeGames`-objektet med interaktions-ID'et. Det aktive spil noterer `userId` og `objectName`.
3. Sender en besked tilbage til kanalen med en knap med et `custom_id` p√• `accept_button_<SOME_ID>`.

> warn
> Kodeeksemplet bruger et objekt som in-memory lagring, men for produktionsapps b√∏r du bruge en database.

N√•r der sendes en besked med [beskedkomponenter](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/what-is-a-component), tilf√∏jes den individuelle nyttelast til et `components`-s√¶t. Anvendelige komponenter (s√•som knapper) skal v√¶re i en [handlingsr√¶kke](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/action-rows), som du kan se kodeeksemplet.

Bem√¶rk det unikke `custom_id`, der blev sendt med beskedkomponenterne, i dette tilf√¶lde `accept_button_` med det aktive spils ID tilf√∏jet. Et `custom_id` kan bruges til at h√•ndtere anmodninger, som Discord sender dig, n√•r nogen interagerer med komponenten, som du vil f√• at se om et √∏jeblik.

N√•r du nu k√∏rer `/challenge`-kommandoen og v√¶lger en valgmulighed, vil din app sende en besked med en **Accept**-knap. Lad os tilf√∏je koden, der h√•ndtere tryk p√• knappen.

</Collapsible>

<Collapsible title="H√•ndtering af knapinteraktioner" description="Kode til h√•ndtering af tryk p√• knapper og besvarelser med en kortvarig besked" icon="code" open>

N√•r brugere interagerer med en beskedkomponent, sender Discord en anmodning med [interaktionstypen](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-object-interaction-type) `3` (eller `MESSAGE_COMPONENT`-v√¶rdien, n√•r der anvendes `discord-interactions`).

For at s√¶tte en handler op for knappen tjekker vi interaktionens `type`, efterfulgt af en matching af `custom_id`.

Inds√¶t f√∏lgende kode under type-handleren for `APPLICATION_COMMAND`:

```javascript
if (type === InteractionType.MESSAGE_COMPONENT) {
// custom_id valg i nyttelast ved afsendelse af beskedkomponent
const componentId = data.custom_id;

  if (componentId.startsWith('accept_button_')) {
    // hent det tilh√∏rende spil-ID
    const gameId = componentId.replace('accept_button_', '');
    // Slet besked med token i anmodningskroppen
    const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
    try {
      await res.send({
        type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
        data: {
          // Henter en tilf√¶ldig emoji, der sendes fra en hj√¶lpefunktion
          content: 'What is your object of choice?',
          // Indikerer, at det bliver en kortvarig besked
          flags: InteractionResponseFlags.EPHEMERAL,
          components: [
            {
              type: MessageComponentTypes.ACTION_ROW,
              components: [
                {
                  type: MessageComponentTypes.STRING_SELECT,
                  // Tilf√∏j spil-ID
                  custom_id: `select_choice_${gameId}`,
                  options: getShuffledOptions(),
                },
              ],
            },
          ],
        },
      });
      // Slet forrige besked
      await DiscordRequest(endpoint, { method: 'DELETE' });
    } catch (err) {
      console.error('Error sending message:', err);
    }
  }
}
```

Koden herover:
1. Tjekker efter et `custom_id`, der matcher det, vi oprindeligt sendte (i dette tilf√¶lde starter det med `accept_button_`). Custom-ID har ogs√• det aktive spil-ID tilf√∏jet, s√• vi gemmer det i `gameID`.
2. [Sletter den oprindelige besked](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/delete-original-interaction-response) ved at kalde en webhook med `node-fetch` og sende den unikke interaktions-`token` i anmodningens krop. Dette g√∏res for at rydde op i kanalen og for at forhindre, at andre brugere kan klikke p√• knappen.
3. Besvarer anmodningen ved at sende en besked, der indeholder en menu med valgmuligheder med genstandene i spillet. Nyttelasten b√∏r se ud ligesom den forrige med undtagelse af `options`-s√¶ttet og `flags: 64`, [der indikerer, at beskeden er kortvarig](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/create-followup-message).

`options`-s√¶ttet befolkes ved hj√¶lp af `getShuffledOptions()`-metoden i `game.js`, der manipulerer `RPSChoices`-v√¶rdierne, s√• de passer til formen p√• [beskedkomponentvalgene](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/select-menu-object-select-option-structure).

</Collapsible>

<Collapsible title="H√•ndtering af menuer med valgmuligheder" description="Kode til at besvare menuinteraktioner med valgmuligheder og opdatere spillets tilstand" icon="code" open>

Til slut skal vi tilf√∏je kode, der h√•ndterer interaktion med menuer med valgmuligheder og sender spillets resultat til kanalen.

Da menuer med valgmuligheder blot er endnu en beskedkomponent, er koden, der h√•ndterer deres interaktioner, n√¶sten identisk med den for knapper.

Modific√©r koden ovenfor, s√• den kan h√•ndtere menuer med valgmuligheder:

```javascript
if (type === InteractionType.MESSAGE_COMPONENT) {
// custom_id valg i nyttelast ved afsendelse af beskedkomponent
const componentId = data.custom_id;

  if (componentId.startsWith('accept_button_')) {
    // hent det tilh√∏rende spil-ID
    const gameId = componentId.replace('accept_button_', '');
    // Slet besked med token i anmodningskroppen
    const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
    try {
      await res.send({
        type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
        data: {
          // Henter en tilf√¶ldig emoji, der sendes fra en hj√¶lpefunktion
          content: 'What is your object of choice?',
          // Indikerer, at det bliver en kortvarig besked
          flags: InteractionResponseFlags.EPHEMERAL,
          components: [
            {
              type: MessageComponentTypes.ACTION_ROW,
              components: [
                {
                  type: MessageComponentTypes.STRING_SELECT,
                  // Tilf√∏j spil-ID
                  custom_id: `select_choice_${gameId}`,
                  options: getShuffledOptions(),
                },
              ],
            },
          ],
        },
      });
      // Slet forrige besked
      await DiscordRequest(endpoint, { method: 'DELETE' });
    } catch (err) {
      console.error('Error sending message:', err);
    }
  } else if (componentId.startsWith('select_choice_')) {
    // hent det tilh√∏rende spil-ID
    const gameId = componentId.replace('select_choice_', '');

    if (activeGames[gameId]) {
      // Hent bruger-ID og valgt genstand for besvarende bruger
      const userId = req.body.member.user.id;
      const objectName = data.values[0];
      // Beregn resultatet fra hj√¶lpefunktion
      const resultStr = getResult(activeGames[gameId], {
        id: userId,
        objectName,
      });

      // Fjern spil fra lager
      delete activeGames[gameId];
      // Opdat√©r besked med token i anmodningskroppen
      const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;

      try {
        // Send resultater
        await res.send({
          type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
          data: { content: resultStr },
        });
        // Opdat√©r kortvarig besked
        await DiscordRequest(endpoint, {
          method: 'PATCH',
          body: {
            content: 'Nice choice ' + getRandomEmoji(),
            components: []
          }
        });
      } catch (err) {
        console.error('Error sending message:', err);
      }
    }
  }
}
```

Ligesom med tidligere kode henter koden herover bruger-ID'et og deres valg af genstand fra interaktionsanmodningen.

Den information, sammen med den oprindelige brugers ID og valg fra `activeGames`-objektet, sendes til `getResult()`-funktionen. `getResult()` bestemmer vinderen og bygger en l√¶selig tekst, der sendes tilbage til kanalen.

Vi kalder ogs√• en anden webhook, denne gang for at [opdater den opf√∏lgende kortvarige besked](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/edit-followup-message), siden den ikke kan slettes.

Endelig sendes resultatet til kanalen med `CHANNEL_MESSAGE_WITH_SOURCE`-interaktionssvartypen.

</Collapsible>

... og det var det üéä Test din app for at sikre, at alt virker.

---

## N√¶ste skridt

Tillykke, du har skabt din f√∏rste Discord-app! ü§ñ

Forh√•bentlig har du l√¶rt en smule om Discord-apps, hvordan du konfigurerer dem, og hvordan du g√∏r dem interaktive. Herfra kan du forts√¶tte med at udvikle din app, eller du kan udforske, hvad der ellers kan lade sig g√∏re:
- L√¶s **[dokumentationen](#DOCS_INTRO)** for dybdeg√•ende information om API-funktioner
- Kig i `examples/`-mappen i dette projekt for mindre, funktionsspecifikke kodeeksempler
- Se vores **[community-ressourcer](#DOCS_TOPICS_COMMUNITY_RESOURCES)** for sprogspecifikke redskaber, leveret af medlemmer af f√¶llesskabet
- L√¶s vores vejledning om at [hoste Discord-apps p√• Cloudflare Workers](#DOCS_TUTORIALS_HOSTING_ON_CLOUDFLARE_WORKERS)
- Slut dig til **[Discord Developers-serveren](https://discord.gg/discord-developers)** for at stille sp√∏rgsm√•l om API'en, deltag i begivenheder afholdt af Discord API-teamet, og interag√©r med andre udviklere
